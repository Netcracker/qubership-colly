---
openapi: 3.1.0
info:
  title: operational-service API
  version: 2.0.0
paths:
  /colly/operational-service/v2/auth-status:
    get:
      responses:
        "200":
          description: OK
          headers:
            X-API-Version:
              schema:
                type: string
      summary: Get Auth Status
      tags:
        - Cluster Resources Rest
  /colly/operational-service/v2/clusters:
    get:
      responses:
        "200":
          description: OK
          headers:
            X-API-Version:
              schema:
                type: string
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ClusterDTO"
      summary: Get Clusters
      tags:
        - Cluster Resources Rest
  /colly/operational-service/v2/clusters/{clusterName}:
    post:
      parameters:
        - name: clusterName
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                description:
                  type: string
        required: true
      responses:
        "201":
          description: Created
          headers:
            X-API-Version:
              schema:
                type: string
        "401":
          description: Not Authorized
          headers:
            X-API-Version:
              schema:
                type: string
        "403":
          description: Not Allowed
          headers:
            X-API-Version:
              schema:
                type: string
      summary: Save Cluster
      tags:
        - Cluster Resources Rest
      security:
        - SecurityScheme:
            - admin
  /colly/operational-service/v2/environments:
    get:
      responses:
        "200":
          description: OK
          headers:
            X-API-Version:
              schema:
                type: string
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/EnvironmentDTO"
      summary: Get Environments
      tags:
        - Cluster Resources Rest
  /colly/operational-service/v2/environments/{envId}:
    post:
      parameters:
        - name: envId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                name:
                  type: string
                owners:
                  type: array
                  items:
                    type: string
                description:
                  type: string
                status:
                  type: string
                labels:
                  type: array
                  items:
                    type: string
                type:
                  type: string
                teams:
                  type: array
                  items:
                    type: string
                expirationDate:
                  type: string
                role:
                  type: string
        required: true
      responses:
        "201":
          description: Created
          headers:
            X-API-Version:
              schema:
                type: string
        "401":
          description: Not Authorized
          headers:
            X-API-Version:
              schema:
                type: string
        "403":
          description: Not Allowed
          headers:
            X-API-Version:
              schema:
                type: string
      summary: Save Environment
      tags:
        - Cluster Resources Rest
      security:
        - SecurityScheme:
            - admin
    delete:
      parameters:
        - name: envId
          in: path
          required: true
          schema:
            type: string
      responses:
        "204":
          description: No Content
          headers:
            X-API-Version:
              schema:
                type: string
        "401":
          description: Not Authorized
          headers:
            X-API-Version:
              schema:
                type: string
        "403":
          description: Not Allowed
          headers:
            X-API-Version:
              schema:
                type: string
      summary: Delete Environment
      tags:
        - Cluster Resources Rest
      security:
        - SecurityScheme:
            - admin
  /colly/operational-service/v2/metadata:
    get:
      responses:
        "200":
          description: OK
          headers:
            X-API-Version:
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApplicationMetadata"
      summary: Get Metadata
      tags:
        - Cluster Resources Rest
  /colly/operational-service/v2/tick:
    post:
      responses:
        "201":
          description: Created
          headers:
            X-API-Version:
              schema:
                type: string
      summary: Load Environments Manually
      tags:
        - Cluster Resources Rest
components:
  schemas:
    ApplicationMetadata:
      type: object
      properties:
        monitoringColumns:
          type: array
          items:
            type: string
        clusterInfoUpdateInterval:
          description: "Period of updating information from the cluster"
          $ref: "#/components/schemas/Duration"
        environmentRoles:
          type: array
          items:
            type: string
          description: list of available Environment roles configured via deployment parameters.
    ClusterDTO:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        clusterInfoUpdateStatus:
          type: object
          properties:
            lastResult:
              type: boolean
              description: >-
                Determines the information update status for cluster: if at
                least one object from the cluster was successfully read,
                the update is considered successful
            lastCompletedAt:
              description: >-
                Time of the last successful update information from the cluster
              $ref: "#/components/schemas/Instant"
    EnvironmentDTO:
      type: object
      properties:
        id:
          type: string
          description: >-
            Unique identifier of the Environment in the service instance.
            Generated automatically upon creation.
          readOnly: true
        name:
          type: string
          description: >-
            Human-readable Environment name. For example, env-1
        namespaces:
          type: array
          description: >-
            List of namespace objects included in the Environment
          items:
            $ref: "#/components/schemas/NamespaceDTO"
        cluster:
          $ref: "#/components/schemas/ClusterDTO"
        owners:
          type: array
          description: >
            Users responsible for the Environment. This attribute is user-defined.
          items:
            type: string
          default: []
          example:
            - Alice
        teams:
          type: array
          description: >
            Teams assigned to the Environment. This attribute is user-defined.
          items:
            type: string
          default: []
          example:
            - QA alpha team
        status:
          $ref: "#/components/schemas/EnvironmentStatus"
          description: >-
            Current status of the Environment. Values: PLANNED, FREE, IN_USE, RESERVED, DEPRECATED.
            Indicates the environment's lifecycle state, e.g. planned but not yet deployed,
            ready for use, in use by a team, reserved, or marked for deprecation.
        expirationDate:
          $ref: "#/components/schemas/LocalDate"
          description: >-
            Date until which Environment is allocated. This attribute is user-defined.
          default: ""
          example:
            - 2025-12-31
        type:
          $ref: "#/components/schemas/EnvironmentType"
          description: >-
            Defines the technical category of the Environment. This attribute is user-defined.
          example:
            - INFRASTRUCTURE
        role:
          type: string
          description: >-
            Defines the usage role of the Environment within the project.
            The list of allowed values is configured via deployment parameters.
            The list of available roles can be retrieved via /colly/operational-service/v2/metadata
          default: ""
        labels:
          type: array
          description: >-
            Custom labels for the Environment. This attribute is user-defined.
          items:
            type: string
          default: []
        description:
          type: string
          description: >-
            Free-form Environment description. This attribute is user-defined.
          default: ""
        cleanInstallationDate:
          $ref: "#/components/schemas/Instant"
        monitoringData:
          type: object
          additionalProperties:
            type: string
        lastSDDeploymentOperation:
          $ref: "#/components/schemas/LastSDDeploymentOperation"
          description: >-
            Information about the most recent SD deployment operation on any namespace that is part of the environment,
            regardless of the deployment result. DD deployments are out of scope.
        lastDeployedSDsByType:
          $ref: "#/components/schemas/LastDeployedSDsByType"
          description: >-
            Map of SD type to the latest successfully deployed SD in the format "<name>:<version>".
            Determines the latest SD of a given type that was successfully deployed to one of the
            namespaces included in the environment.
        region:
          type: string
          description: >-
            Geographical region associated with the Environment. This attribute is user-defined.
        deploymentOperations:
          $ref: "#/components/schemas/DeploymentOperations"
      required:
        - id
        - name
        - namespaces
        - cluster
    EnvironmentStatus:
      type: string
      enum:
        - PLANNED
        - FREE
        - IN_USE
        - RESERVED
        - DEPRECATED
      default: FREE
    EnvironmentType:
      type: string
      enum:
        - ENVIRONMENT
        - CSE_TOOLSET
        - DESIGN_TIME
        - APP_DEPLOYER
        - INFRASTRUCTURE
        - UNDEFINED
      default: ENVIRONMENT
    Instant:
      type: string
      format: date-time
      examples:
        - 2022-03-10T16:15:50Z
    DeploymentOperations:
      type: array
      description: >-
        Array of deployment operations for all namespaces related to the Environment.
        Each element represents a separate deployment operation that may involve one or more
        namespaces and consists of multiple SD (Solution Descriptor) deployments.
      items:
        type: object
        properties:
          completedAt:
            type: string
            format: date-time
            description: >-
              Time when the deployment operation finished. This operation may involve one or more
              namespaces that are part of the Environment. The time reflects when all deployment
              items in this operation completed, regardless of their individual outcomes.
            example: 2022-03-10T16:15:50Z
          status:
            type: string
            enum:
              - SUCCESS
              - FAILURE
              - PARTIAL
            description: >-
              Overall status of the deployment operation:
              - SUCCESS: all deployment items completed successfully
              - FAILURE: all deployment items failed
              - PARTIAL: some deployment items succeeded, some failed
            example: SUCCESS
          deploymentItems:
            type: array
            description: >-
              List of SD (Solution Descriptor) deployments that are part of this deployment operation.
              Each entry represents a single SD deployment with its details.
            items:
              type: object
              properties:
                name:
                  type: string
                  description: >-
                    Name and version of the SD in format "<name>:<version>".
                  example: product-sd:1.2.3
                type:
                  type: string
                  description: >-
                    Type of SD (e.g., "product", "project", etc.).
                  example: product
                mode:
                  type: string
                  enum:
                    - CLEAN_INSTALL
                    - ROLLING_UPDATE
                  description: >-
                    Deployment mode for the SD:
                    - CLEAN_INSTALL: remove all existing resources before deployment
                    - ROLLING_UPDATE: deploy on top of existing resources
                  example: CLEAN_INSTALL
                status:
                  type: string
                  enum:
                    - SUCCESS
                    - FAILURE
                  description: >-
                    Result of the deployment operation for this SD.
                  example: SUCCESS
              required:
                - name
                - type
                - mode
                - status
      required:
        - completedAt
        - status
        - deploymentItems
      example:
        - completedAt: 2022-03-10T16:15:50Z
          status: PARTIAL
          deploymentItems:
            - name: product-sd:1.2.3
              type: product
              mode: ROLLING_UPDATE
              status: SUCCESS
            - name: project-sd:2.1.0
              type: project
              mode: ROLLING_UPDATE
              status: FAILURE
    LastSDDeploymentOperation:
      type: object
      description: >-
        Information about the most recent SD deployment operation on any namespace that is part of the environment,
        regardless of the deployment result
      properties:
        status:
          type: string
          description: >-
            Status of the most recent SD deployment operation on any namespace that is part of the environment.
          enum:
            - SUCCESS
            - FAILURE
          example: SUCCESS
        completedAt:
          type: string
          description: >-
            Time when the most recent SD deployment operation finished on any namespace that is part of the environment,
            regardless of the deployment result.
          format: date-time
          example: 2022-03-10T16:15:50Z
      required:
        - status
        - completedAt
      example:
        status: SUCCESS
        completedAt: 2022-03-10T16:15:50Z
    LastDeployedSDsByType:
      type: object
      description: >-
        Map of SD type to the latest successfully deployed SD in the format "<name>:<version>".
        Determines the latest SD of a given type that was successfully deployed to one of the
        namespaces included in the environment.
      additionalProperties:
        type: string
        description: SD name and version in "<name>:<version>" format
      example:
        product: product-sd:1.2.3
        project: my-project:1.2.3
    LocalDate:
      type: string
      format: date
      examples:
        - 2022-03-10
    NamespaceDTO:
      type: object
      properties:
        uid:
          type: string
        name:
          type: string
        existsInK8s:
          type: boolean
        deployPostfix:
          type: string
          description: >-
            Deploy postfix, namespace role in solution
    Duration:
      type: string
      format: duration
      description: >-
        Duration in ISO 8601 format (e.g., 'PT30M' for 30 minutes, 'PT2H' for 2
        hours, 'P1D' for 1 day)
      examples:
        - "PT30M"
        - "PT2H"
        - "P1D"
        - "PT1H30M"
  securitySchemes:
    SecurityScheme:
      type: openIdConnect
      description: Authentication
      openIdConnectUrl: >-
        http://host.docker.internal:8180/realms/quarkus/.well-known/openid-configuration
